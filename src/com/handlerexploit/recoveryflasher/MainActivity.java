package com.handlerexploit.recoveryflasher;

import java.util.ArrayList;
import java.util.List;

import android.os.AsyncTask;
import android.os.Bundle;
import android.support.v4.app.FragmentActivity;
import android.support.v4.view.ViewPager;

import com.handlerexploit.recoveryflasher.adapters.PagerAdapter;
import com.handlerexploit.recoveryflasher.fragments.ExtendedDeviceFragment;
import com.handlerexploit.recoveryflasher.models.ExtendedDevice;
import com.handlerexploit.recoveryflasher.utils.Parser;
import com.handlerexploit.recoveryflasher.utils.Utils;

public class MainActivity extends FragmentActivity {

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);
        new NetworkOperationsTask().execute(new Parser(this));
    }
    
    public static enum Device {
        CLIQ("Motorola Cliq", "http://dl.dropbox.com/u/788286/com.adlx.recoveryflasher/motorola.mb200.json"),
        CLIQXT("Motorola CliqXT", "http://dl.dropbox.com/u/788286/com.adlx.recoveryflasher/motorola.mb501.json");

        private String name;
        private String url;

        Device(String name, String url) {
            this.name = name;
            this.url = url;
        }

        public String getName() {
            return name;
        }

        public String getUrl() {
            return url;
        }
    }
    
    private class NetworkOperationsTask extends AsyncTask<Parser, Void, List<ExtendedDevice>> {

        @Override
        protected List<ExtendedDevice> doInBackground(Parser... params) {
            List<ExtendedDevice> extendedDevices = new ArrayList<ExtendedDevice>();
            for (Device device : Device.values()) {
                extendedDevices.add(params[0].requestExtendedDevice(device));
            }
            return extendedDevices;
        }
        
        @Override
        public void onPostExecute(List<ExtendedDevice> results) {
            PagerAdapter pagerAdapter = new PagerAdapter(MainActivity.this);
            
            for (ExtendedDevice extendedDevice : results) {
                Bundle bundle = new Bundle();
                bundle.putSerializable(ExtendedDeviceFragment.EXTRA_DEVICE, extendedDevice);
                pagerAdapter.add(ExtendedDeviceFragment.class, bundle);
            }
            
            ViewPager viewPager = (ViewPager) findViewById(R.id.viewPager);
            Utils.disableOverscrollMode(viewPager);
            viewPager.setAdapter(pagerAdapter);
        }
    }
}