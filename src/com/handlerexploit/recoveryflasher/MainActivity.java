package com.handlerexploit.recoveryflasher;

import java.util.ArrayList;
import java.util.List;
import com.handlerexploit.recoveryflasher.fragments.ExtendedDeviceFragment;
import com.handlerexploit.recoveryflasher.models.ExtendedDevice;
import com.handlerexploit.recoveryflasher.utils.Parser;

import android.os.AsyncTask;
import android.os.Bundle;
import android.support.v4.app.FragmentActivity;

public class MainActivity extends FragmentActivity {

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        new NetworkOperationsTask().execute(Device.values());
    }
    
    public static enum Device {
        CLIQ("Motorola Cliq", "http://dl.dropbox.com/u/788286/com.adlx.recoveryflasher/motorola.mb200.json"),
        CLIQXT("Motorola CliqXT", "http://dl.dropbox.com/u/788286/com.adlx.recoveryflasher/motorola.mb501.json");
        
        private String name;
        private String url;
        
        Device(String name, String url) {
            this.name = name;
            this.url = url;
        }
        
        public String getName() {
            return name;
        }
        
        public String getUrl() {
            return url;
        }
    }
    
    private class NetworkOperationsTask extends AsyncTask<Device, Void, List<ExtendedDevice>> {

        @Override
        protected List<ExtendedDevice> doInBackground(Device... params) {
            List<ExtendedDevice> extendedDevices = new ArrayList<ExtendedDevice>();
            for (Device device : params) {
                extendedDevices.add(Parser.requestExtendedDevice(device));
            }
            return extendedDevices;
        }
        
        @Override
        public void onPostExecute(List<ExtendedDevice> results) {
            ExtendedDeviceFragment extendedDeviceFragment = new ExtendedDeviceFragment(results.get(0));
            getSupportFragmentManager().beginTransaction().add(android.R.id.content, extendedDeviceFragment).commit();
        }
    }
}